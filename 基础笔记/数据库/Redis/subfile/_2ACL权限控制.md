# ACL访问控制列表

Redis ACL 是访问控制列表的简短功能，它允许对某些连接限制其可执行的命令和可访问的键。其工作方式是，连接后，客户端需要验证提供用户名和有效密码：如果身份验证阶段成功，连接会与用户和用户的限制关联。可以配置 Redis，以便新连接已经使用"默认"用户进行身份验证（这是默认配置），因此配置默认用户具有仅向未经过显式身份验证的连接提供特定功能子集的功能。

在默认配置中，Redis 6（具有 ACL 的第一个版本）的工作方式与旧版本的 Redis 完全相同，也就是说，每个新连接都能够调用每个可能的命令并访问每个密钥，因此 ACL 功能向后与旧客户端和应用程序兼容。此外，使用需要通道配置指令**配置**密码的旧方法仍按能够使用，但现在只需为默认用户设置密码即可。

在Redis 6版本中`AUTH`命令有所扩展，现在该命令可以使用两个参数：

```shell
AUTH <username> <password>
```

当你按照旧的形式使用该命令时：

```shell
AUTH <password>
```

它将使用默认的用户名`default`，也就是说如果我们只指定密码就会使用默认用户身份进行验证，这提供了完美的旧版本兼容性。

## 什么时候使用ACL

在你用ACL之前，你需要问一下你自己需要通过这一功能去达到什么目标。通过ACL可以很好的满足两个目标：

1. 您希望通过限制对命令和密钥的访问来提高安全性，这样不受信任的客户机就没有访问权限，而受信任的客户机只有对数据库的最低访问级别，以便执行所需的工作。例如，某些客户端可能只能够执行只读命令。
2. 您想提高操作安全性，以防止由于软件错误或人为错误而导致进程或人员访问Redis，从而损坏数据或配置。 例如，没有必要让工作人员从Redis获取延迟的作业来调用FLUSH ALL命令。

ACL另一个典型应用时关于Redis实例托管。Redis通常由内部公司团队作为托管服务提供，Redis通常由管理内部Redis基础结构的内部公司团队为其所拥有的其他内部客户提供的一项托管服务，或者由云提供商在`软件即服务`设置中提供。 在这两种设置中，我们都希望确保为客户排除配置命令。 过去通过命令重命名来完成此操作的方式是一种技巧，它使我们能够长时间不用ACL，但这并不是一个理想的状态。

## 使用ACL命令配置ACL权限

ACL是使用DSL（域特定语言）定义的，该DSL描述了给定用户能够执行的操作。 此类规则始终从左到右从第一个到最后一个实施，因为有时规则的顺序对于理解用户的实际能力很重要。

默认情况下有一个名字叫`default`的用户被定义。我们可以使用`ACL LIST`命令顺序检查当前有效的ACL以及校验新配置的ACL，Redis实例的默认配置是这样：

```shell
> ACL LIST
1) "user default on nopass ~* &* +@all"
```

上面的命令通过将用户的当前acl集转换回它们的描述，以与Redis配置文件中使用的格式相同的格式报告用户列表。

每一行的前两个单词是“user”跟着用户名，紧接着后面字符用于描述不同的ACL规则。我们将详细介绍规则的工作原理，但是现在我们只需要说明默认用户被配置为active (`on`)，不需要密码（`nopass`），能够访问所有的键（`~*`）,发布并订阅（`&*`），以及使用任何命令（`+@all`）就足够了。

另外，在指定的默认用户的示例中，拥有`nopass`意味着一个新的连接将自动的通过default用户认证，而不需要调用`AUTH`命令进行认证。

## ACL规则

下面是有效的ACL列表