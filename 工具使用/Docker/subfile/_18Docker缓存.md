# Docker缓存

Docker 为了加快镜像构建的速度，也会将每一个镜像层缓存下来。Docker 的缓存特性能大 大提高工作效率，可是它的实现却有点笨拙。你的指令必须满足以下条件，Docker 才会使用缓存：

- 上一个指令能够在缓存中找得到

- 缓存中存在一个镜像层，而它的指令与你的指令一模一样，父层也完全相同（即使指令 

  中出现一些无关重要的空格也会使缓存失效）

- COPY 和 ADD 指令，如果它们引用的文件的校验和或元数据发生了变化，那么缓存也将失效

这意味着，即使那些每次调用的结果可能都不一样的 RUN 指令，也仍然会被缓存。如果需要下载文件、执行 apt-get update 或复制源码库，请务必注意这一点。

如果你需要使缓存失效，可以在执行 docker build 的时候加上 --no-cache 参数。你还可以通过添加或修改一个指令，使之后的缓存失效；因此，你可能在一些 `Dockerfile` 里会看到类似这样的写法：

```shell
ENV UPDATED_ON "14:12 17 February 2015" 
RUN git clone....
```

我不推荐这个方法，因为它会让将来使用这个镜像的用户感到困惑，尤其是镜像创建的日期与其中所写的不一样时。

